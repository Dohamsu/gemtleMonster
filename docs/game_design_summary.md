# 도트 방치형 웹게임 기획 문서

## 0. 프로젝트 개요

- **프로젝트 타입**: 도트 그래픽 기반 웹 게임
- **장르**: 방치형 + 던전 전투 + 연금술(몬스터 제작/강화)
- **플랫폼**: 웹 브라우저(PC/모바일 대응/PWA)
- **세계관/컨셉**:
  - 판타지 중세 배경
  - 플레이어는 연금술사 겸 용병단/몬스터 주인
  - 농장·광산·숲 등에서 재료를 방치 채집하고, 그 재료로 몬스터/용병을 만들어 던전에 보냄

---

## 1. 코어 게임 루프

1. **방치 채집 (Facilities)**
   - 농장/광산/훈련장/성소 등 시설을 건설하고 배치된 몬스터/도구에 의해 재료 자동 생산
   - 일정 확률로 **희귀 재료** 또는 **이벤트 아이템** 드랍

2. **연금술 & 몬스터 제작 (Alchemy)**
   - 채집 재료 + 던전 드랍 재료를 조합해서 몬스터 생성
   - **레시피 기반 조합**과 **자유 실험(레시피 없음)** 모두 가능
   - 조합 실패 시에도 경험치 획득 및 힌트 시스템 작동

3. **던전 전투 & 오토 배틀**
   - 스테이지형 던전 구조
   - 파티를 구성하여 자동 던전 파견 (시간 소요)
   - 클리어 시 유니크 재료 획득

4. **성장 및 순환**
   - 시설 업그레이드 (생산 효율 증가)
   - 몬스터 레벨업 및 **분해**(정수/파편 획득)
   - 연금술 레벨 상승에 따른 상위 레시피 해금

---

## 2. 시스템 설계

### 2.1 방치형 채집 시스템 (Facilities)

현재 구현된 주요 시설 목록:

| ID | 이름 | 카테고리 | 주요 산출물 | 비고 |
|---|---|---|---|---|
| `herb_farm` | 약초 농장 | 생산 | 일반 약초, 희귀 약초 | 가장 기초적인 생산 시설 |
| `mine` | 광산 | 생산 | 철광석, 마력 광석, 보석 파편 | 광물 자원 수급처 |
| `monster_farm` | 몬스터 농장 | 성장 | (행복도/버프) | 몬스터 수용량 증가 및 관리 |
| `training_ground` | 훈련장 | 성장 | (경험치, 토큰) | 배치된 몬스터 자동 레벨업 |
| `spirit_sanctum` | 정령의 성소 | 생산 | 정령 가루, 빛의 정수 | 희귀 연금 재료 생산 |
| `dungeon_dispatch` | 파견소 | 전투 | (던전 보상) | 자동 사냥 관리 시설 |

- **업그레이드**: 골드 및 특정 재료를 소모하여 레벨업 가능 (생산주기 단축, 드랍률 상승, 슬롯 확장 등).

---

### 2.2 연금술 시스템 (Alchemy)

#### 2.2.1 특징
- **레시피 매칭**: 재료 조합이 레시피와 일치하면 성공 확률에 따라 몬스터 생성
- **실험 모드**: 일치하는 레시피가 없어도 조합 시도 가능 (결과는 실패지만 경험치 획득)
- **실패 보정**:
  - 실패해도 소량의 경험치 획득 (Partial XP)
  - 연속 실패 시 '힌트' 시스템 발동 (발견되지 않은 레시피의 재료/속성 힌트 제공)

#### 2.2.2 재료 타입
- **PLANT**: 약초, 포자, 꽃 등 (생명/회복 계열)
- **MINERAL**: 광석, 보석, 파편 등 (방어/골렘 계열)
- **BEAST**: 가죽, 뼈, 발톱 등 (물리/야수 계열)
- **SLIME**: 코어, 젤, 액체 (슬라임/변이 계열)
- **SPIRIT**: 정령 가루, 정수, 룬 (마법/정령 계열)
- **SPECIAL**: 던전 보스 드랍, 고대 유물 등 (특수/상위 몬스터)

#### 2.2.3 몬스터 분해
- 남는 몬스터를 분해하여 `몬스터 정수(Essence)` 및 `속성 파편(Shard)` 획득
- 획득한 정수와 파편은 상위 연금술의 촉매나 재료로 재사용

---

### 2.3 기술 스택 및 아키텍처

#### 프론트엔드
- **Build**: Vite
- **Framework**: React (SPA/PWA)
- **Language**: TypeScript
- **State**: Zustand (로컬 상태), TanStack Query (서버 상태 캐싱 권장)
- **Rendering**:
  - **Canvas API**: 시설 맵, 몬스터 배치 시각화, 연금술 연출
  - **DOM**: UI 오버레이, 모달, 리스트

#### 백엔드 (BaaS)
- **Platform**: Supabase
- **Database**: PostgreSQL
- **Logic**:
  - **RPC (PL/pgSQL)**: `perform_alchemy`, `consume_materials` 등 핵심 로직 서버 처리로 보안 강화
  - **Realtime**: (선택적 사용)

#### 주요 데이터 흐름
1. 클라이언트 동작 (조합/건설)
2. Supabase RPC 호출
3. DB 트랜잭션 처리 (재료 차감, 결과 생성, 로그 기록)
4. 결과 반환 및 클라이언트 UI 업데이트
