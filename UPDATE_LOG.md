# 2025-12-02 업데이트: 연금술 조합 로직 개선 및 버그 수정

## 1. 연금술 조합 로직 개선
- **최소 수량 매칭 지원**: 정확한 수량이 아닌, 최소 필요 수량만 충족하면 조합이 가능하도록 변경했습니다. (예: 필요량보다 재료를 많이 넣어도 조합 성공)
- **최적 레시피 자동 선택**: 여러 레시피가 매칭될 경우, 재료를 가장 많이 소모하는(더 복잡한) 레시피가 우선적으로 선택되도록 로직을 개선했습니다.

## 2. 버그 수정
- **DB 함수 오류 수정**: `update_recipe_craft_count` 호출 시 발생하는 타입 불일치 오류를 수정하여 조합 카운트가 정상적으로 기록되도록 조치했습니다.

---

# 업데이트 로그: 고급 연금술 시스템 및 DB 스키마 확장

## 1. 고급 연금술 시스템 통합
- **조건부 레시피 구현**: 시간, 날씨, 장치 등 다양한 조건에 따라 조합 가능 여부를 판단하는 로직 추가.
- **컨텍스트 기반 조합**: `AlchemyContext`를 통해 현재 게임 환경(시간, 위치 등)을 실시간으로 반영.
- **UI 통합**: `GameCanvas`에서 연금술 컨텍스트를 연동하여 실시간 상태 반영.

## 2. 데이터베이스 스키마 확장
- **몬스터 마스터 테이블 (`monster`) 생성**: 
  - 몬스터의 기본 스탯(HP, ATK, DEF), 속성, 역할, 등급 정보 저장.
  - `icon_url` 컬럼을 통해 이미지 리소스 관리 (로컬 에셋 연동).
- **재료 테이블 (`material`) 확장**: `sell_price` 컬럼 추가로 상점 판매 기능 지원.
- **레시피 조건 테이블 (`recipe_condition`) 고도화**: 다양한 조건 타입(JSON, Int, Text 등)을 유연하게 저장할 수 있도록 구조 변경.

## 3. 개발 환경 개선
- **Supabase CLI 타입 자동 생성**: 
  - DB 스키마 변경 시 `npm run types:generate` 명령어로 TypeScript 타입을 자동 동기화.
  - `database.types.ts`를 통해 Type-safe한 개발 환경 구축.

## 4. 데이터 마이그레이션
- **기초 데이터 추가**: 기본 슬라임, 골렘 등 10여 종의 몬스터 데이터 및 이미지 경로 매핑 완료.
- **테스트 레시피 추가**: 시간/조건부 특수 레시피 5종 추가.

## 5. 상점 판매 동기화 안정화
- **문제**: 레거시 자원 판매 시 DB 동기화가 실패해도 클라이언트가 즉시 재고를 차감하고 골드를 지급하여 실제 DB 상태와 불일치가 발생할 수 있었음.
- **개선**: `sellResource`를 비동기 함수로 전환해 DB 연동(consumeMaterials)이 성공했을 때만 로컬 자원 차감과 골드 지급이 이뤄지도록 변경하고, 판매 결과를 boolean으로 반환해 UI가 실패한 판매를 건너뛰도록 수정.

## 6. 신규 던전 및 몬스터 확장
- **신비한 호수 던전 추가**:
  - 물 속성 몬스터(워터 슬라임, 호수의 요정 등)가 등장하는 새로운 던전.
  - 던전 선택 UI를 통해 원하는 던전으로 입장 가능.
- **전투 UI 고도화**:
  - 아군 및 적군 몬스터 이미지 표시 (이모지 대체).
  - 전리품 로그 한글화 적용.
  - 몬스터 데이터 동기화 및 'Unknown' 이름 오류 수정.
